<!DOCTYPE html>
<!-- sudah sama bahasa indonesi inggris dan china, ukuran pas -->
<html lang="en">
<head>
  <meta name="theme-color" content="#0f172a" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tanda Tangan Digital - Navigasi Halaman</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    canvas.signature-canvas {
      border: 2px dashed #d1d5db;
      background: #fff;
      width: 100%;
      height: 300px;
      cursor: crosshair;
    }
    .signature-img {
      max-width: 100%;
      max-height: 100%;
      cursor: move;
    }
    .pdf-page-wrapper {
      position: relative;
      margin-bottom: 20px;
    }
    .resizable-wrapper {
      position: absolute;
      border: 1px dashed #999;
      background: transparent;
    }
  </style>
</head>
$1
  <div class="flex justify-end p-4">
  <div class="flex items-center space-x-3">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6h4" />
    </svg>
    <label class="text-base font-medium text-gray-700">Language:</label>
    <select id="languageSwitcher" class="border border-gray-300 rounded px-3 py-2 text-base font-semibold">
      <option value="id">üáÆüá© Indonesia</option>
      <option value="en">üá∫üá∏ English</option>
      <option value="zh">üá®üá≥ ‰∏≠Êñá</option>
    </select>
  </div>
</div>
<div class="max-w-6xl mx-auto p-4 sm:p-6 md:p-8 lg:p-10 w-full bg-gradient-to-b from-white to-blue-50 rounded-lg shadow-xl">
  <h1 class="text-3xl font-extrabold text-center mb-6 text-blue-900 tracking-tight">Tanda Tangan Digital PDF</h1>

  <!-- Signature Section -->
  <section class="mb-12 bg-white p-6 rounded-lg shadow border border-blue-400 transition duration-500 hover:shadow-lg hover:border-blue-500">
    <h2 class="text-xl font-semibold mb-2">1. Buat Tanda Tangan</h2>
    <canvas id="signatureCanvas" class="signature-canvas w-full h-[300px] sm:h-[300px] md:h-[350px]"></canvas>
    <div class="mt-4 flex flex-col sm:flex-row gap-2 justify-start">
      <button onclick="clearSignature()" class="bg-gray-200 text-black px-4 py-2 rounded hover:opacity-90 transition">Hapus</button>
      <button onclick="previewSignature()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition">Preview</button>
      <button onclick="saveSignature()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition">Simpan</button>
    </div>
    <div id="signaturePreview" class="mt-4 w-full overflow-auto"></div>
  </section>

  <!-- Upload PDF -->
  <section class="mb-12 bg-white p-6 rounded-lg shadow border border-blue-200 transition duration-500 hover:shadow-lg hover:border-blue-400">
    <h2 class="text-xl font-semibold mb-2">2. Unggah PDF dan Navigasi Halaman</h2>
    <input type="file" id="pdfInput" accept="application/pdf" class="mb-4" />
    <div class="flex flex-wrap items-center gap-2 sm:gap-4 mb-4">
      <button onclick="prevPage()" class="bg-gray-300 px-3 py-1 rounded">‚Üê</button>
      <input type="number" id="pageNumber" min="1" class="border rounded px-2 py-1 w-20" />
      <button onclick="goToPage()" class="bg-blue-500 text-white px-3 py-1 rounded">Go</button>
      <button onclick="nextPage()" class="bg-gray-300 px-3 py-1 rounded">‚Üí</button>
      <span id="pageInfo" class="ml-2 text-sm text-gray-700"></span>
    </div>
    <div id="pdfContainer"></div>
  </section>

  <!-- Download PDF -->
  <section class="mb-12 bg-white p-6 rounded-lg shadow border border-blue-400 transition duration-500 hover:shadow-lg hover:border-blue-500">
    <h2 class="text-xl font-semibold mb-2">3. Simpan & Unduh</h2>
    <button onclick="downloadSignedPDF()" class="bg-indigo-600 text-white px-6 py-2 rounded">Unduh PDF Bertanda Tangan</button>
  </section>
</div>

<script>
let canvas = new fabric.Canvas('signatureCanvas', { isDrawingMode: true });
canvas.freeDrawingBrush.color = '#000';
canvas.freeDrawingBrush.width = 2;
let savedSignature = null;

function clearSignature() {
  canvas.clear();
}

function previewSignature() {
  const dataUrl = canvas.toDataURL();
  const img = document.createElement('img');
  img.src = dataUrl;
  img.className = 'border shadow w-64';
  const preview = document.getElementById('signaturePreview');
  preview.innerHTML = '<p class="mb-2">Preview:</p>';
  preview.appendChild(img);
}

function saveSignature() {
  if (canvas.isEmpty()) return alert('Tanda tangan kosong');
  savedSignature = canvas.toDataURL();
  alert('Tanda tangan berhasil disimpan.');
}

let pdfDoc = null;
let currentPage = 1;
let totalPages = 0;
let signatures = {};

function renderPage(num) {
  pdfDoc.getPage(num).then(page => {
    const scale = 1.5;
    const viewport = page.getViewport({ scale });
    const canvasEl = document.createElement('canvas');
    const context = canvasEl.getContext('2d');
    canvasEl.height = viewport.height;
    canvasEl.width = viewport.width;

    page.render({ canvasContext: context, viewport }).promise.then(() => {
      const container = document.getElementById('pdfContainer');
      container.innerHTML = '';
      const wrapper = document.createElement('div');
      wrapper.className = 'pdf-page-wrapper';
      wrapper.appendChild(canvasEl);

      const signBtn = document.createElement('button');
      signBtn.textContent = 'Tempel Tanda Tangan';
      signBtn.className = 'mt-2 bg-blue-500 text-white px-4 py-1 rounded';
      signBtn.onclick = () => {
        if (!savedSignature) return alert('Simpan tanda tangan terlebih dahulu.');

        const containerSig = document.createElement('div');
        containerSig.style.position = 'absolute';
        containerSig.style.left = '50px';
        containerSig.style.top = '50px';
        containerSig.style.width = '150px';
        containerSig.className = 'resizable-wrapper';

        const img = document.createElement('img');
        img.src = savedSignature;
        img.className = 'signature-img';
        img.setAttribute('draggable', false);

        // Tambahkan tombol + dan - di ujung kiri dan kanan
        const minusBtn = document.createElement('button');
        minusBtn.textContent = '-';
        minusBtn.className = 'text-white bg-red-500 px-2 py-1 rounded-full text-xs absolute -top-4 -left-4';
        minusBtn.onclick = function () {
          const curr = parseInt(containerSig.style.width);
          if (curr > 30) containerSig.style.width = (curr - 10) + 'px';
        };

        const plusBtn = document.createElement('button');
        plusBtn.textContent = '+';
        plusBtn.className = 'text-white bg-green-500 px-2 py-1 rounded-full text-xs absolute -top-4 -right-4';
        plusBtn.onclick = function () {
          const curr = parseInt(containerSig.style.width);
          if (curr < 600) containerSig.style.width = (curr + 10) + 'px';
        };

        containerSig.appendChild(minusBtn);
        containerSig.appendChild(plusBtn);
        containerSig.appendChild(img);
        makeDraggable(containerSig);
        wrapper.appendChild(containerSig);

        if (!signatures[num]) signatures[num] = [];
        signatures[num].push(containerSig);
      };

      wrapper.appendChild(signBtn);
      container.appendChild(wrapper);

      document.getElementById('pageInfo').textContent = `Halaman ${currentPage} / ${totalPages}`;
    });
  });
}

function goToPage() {
  const num = parseInt(document.getElementById('pageNumber').value);
  if (num >= 1 && num <= totalPages) {
    currentPage = num;
    renderPage(currentPage);
  } else {
    const lang = document.getElementById('languageSwitcher').value;
    const msg = {
      id: 'Halaman tidak tersedia, silakan cek lagi.',
      en: 'Page not available, please check again.',
      zh: 'È°µÈù¢‰∏çÂ≠òÂú®ÔºåËØ∑Ê£ÄÊü•„ÄÇ'
    };
    alert(msg[lang] || msg['id']);
  }
}

function nextPage() {
  if (currentPage < totalPages) {
    currentPage++;
    renderPage(currentPage);
  }
}

function prevPage() {
  if (currentPage > 1) {
    currentPage--;
    renderPage(currentPage);
  }
}

function makeDraggable(elmnt) {
  let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
  elmnt.ontouchstart = elmnt.onmousedown = function (e) {
    e.preventDefault();
    pos3 = e.clientX;
    pos4 = e.clientY;
    document.onmouseup = document.ontouchend = closeDragElement;
    document.onmousemove = document.ontouchmove = elementDrag;
  };
  function elementDrag(e) {
    e = e.touches ? e.touches[0] : e;
    pos1 = pos3 - e.clientX;
    pos2 = pos4 - e.clientY;
    pos3 = e.clientX;
    pos4 = e.clientY;
    elmnt.style.top = elmnt.offsetTop - pos2 + 'px';
    elmnt.style.left = elmnt.offsetLeft - pos1 + 'px';}
  function closeDragElement() {
    document.onmouseup = null;
    document.onmousemove = null;
  }
}

async function downloadSignedPDF() {
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF({ unit: 'pt', format: 'a4' });
  for (let i = 1; i <= totalPages; i++) {
    const page = await pdfDoc.getPage(i);
    const viewport = page.getViewport({ scale: 2 });
    const canvas = document.createElement('canvas');
    const context = canvas.getContext('2d');
    canvas.height = viewport.height;
    canvas.width = viewport.width;
    await page.render({ canvasContext: context, viewport }).promise;

    const scaleRatio = 595.28 / canvas.width;
    pdf.addImage(canvas.toDataURL('image/jpeg'), 'JPEG', 0, 0, 595.28, canvas.height * scaleRatio);

    if (signatures[i]) {
      for (let wrapper of signatures[i]) {
        const pdfCanvas = wrapper.parentElement.querySelector('canvas');
const ratioX = wrapper.offsetLeft / pdfCanvas.offsetWidth;
const ratioY = wrapper.offsetTop / pdfCanvas.offsetHeight;
const x = ratioX * 595.28 + 5;
const y = ratioY * (canvas.height * scaleRatio) + 10;
        const w = wrapper.offsetWidth * scaleRatio;
        const h = wrapper.offsetHeight * scaleRatio;
        const img = wrapper.querySelector('img');
        const tempCanvas = document.createElement('canvas');
        tempCanvas.width = img.naturalWidth;
        tempCanvas.height = img.naturalHeight;
        const tempCtx = tempCanvas.getContext('2d');
        tempCtx.drawImage(img, 0, 0);
        pdf.addImage(tempCanvas.toDataURL('image/png'), 'PNG', x, y, w, h);
      }
    }
    if (i < totalPages) pdf.addPage();
  }
  const input = document.getElementById('pdfInput');
  const originalName = input.files[0]?.name || 'dokumen.pdf';
  const filename = 'sign_' + originalName.replace(/\.pdf$/i, '') + '.pdf';
  pdf.save(filename);
}

document.getElementById('pdfInput').addEventListener('change', async function (e) {
  const file = e.target.files[0];
  if (!file) return;
  const arrayBuffer = await file.arrayBuffer();
  const loadingTask = pdfjsLib.getDocument({ data: arrayBuffer });
  pdfDoc = await loadingTask.promise;
  totalPages = pdfDoc.numPages;
  currentPage = 1;
  document.getElementById('pageNumber').value = 1;
  renderPage(currentPage);
});
</script>
<script>
  const translations = {
    en: {
      '1. Buat Tanda Tangan': '1. Create Signature',
      'Tanda Tangan Digital PDF': 'Digital PDF Signature',
      'Tanda Tangan Anda': 'Your Signature',
      'Buat tanda tangan di area di atas': 'Draw your signature above',
      'Preview:': 'Preview:',
      'Hapus': 'Clear',
      'Simpan': 'Save',
      '2. Unggah PDF dan Navigasi Halaman': '2. Upload PDF and Navigate Pages',
      'Go': 'Go',
      '‚Üê': '‚Üê',
      '‚Üí': '‚Üí',
      '3. Simpan & Unduh': '3. Save & Download',
      'Unduh PDF Bertanda Tangan': 'Download Signed PDF',
      'Tempel Tanda Tangan': 'Insert Signature',
      'Tanda tangan kosong': 'Signature is empty',
      'Tanda tangan berhasil disimpan.': 'Signature saved successfully.',
      'Halaman': 'Page'
    },
    zh: {
      '1. Buat Tanda Tangan': '1. ÂàõÂª∫Á≠æÂêç',
      'Tanda Tangan Digital PDF': 'PDF Êï∞Â≠óÁ≠æÂêç',
      'Tanda Tangan Anda': 'ÊÇ®ÁöÑÁ≠æÂêç',
      'Buat tanda tangan di area di atas': 'Âú®‰∏äÊñπÂå∫ÂüüÁªòÂà∂Á≠æÂêç',
      'Preview:': 'È¢ÑËßàÔºö',
      'Hapus': 'Ê∏ÖÈô§',
      'Simpan': '‰øùÂ≠ò',
      '2. Unggah PDF dan Navigasi Halaman': '2. ‰∏ä‰º† PDF Âπ∂ÊµèËßàÈ°µÈù¢',
      'Go': 'Ë∑≥ËΩ¨',
      '‚Üê': '‚Üê',
      '‚Üí': '‚Üí',
      '3. Simpan & Unduh': '3. ‰øùÂ≠òÂπ∂‰∏ãËΩΩ',
      'Unduh PDF Bertanda Tangan': '‰∏ãËΩΩÂ∑≤Á≠æÂêç PDF',
      'Tempel Tanda Tangan': 'Á≤òË¥¥Á≠æÂêç',
      'Tanda tangan kosong': 'Á≠æÂêç‰∏∫Á©∫',
      'Tanda tangan berhasil disimpan.': 'Á≠æÂêçÂ∑≤‰øùÂ≠ò„ÄÇ',
      'Halaman': 'Á¨¨ È°µ'
    }
  };

  const switchLang = lang => {
    document.querySelectorAll('[data-i18n]').forEach(el => {
      const key = el.getAttribute('data-i18n');
      if (translations[lang][key]) el.textContent = translations[lang][key];
    });
    document.querySelectorAll('button, h1, h2, label, span').forEach(el => {
      const t = el.textContent.trim();
      if (translations[lang][t]) el.textContent = translations[lang][t];
    });
  };

  document.getElementById('languageSwitcher').addEventListener('change', e => {
    switchLang(e.target.value);
  });

  // Default to Indonesian
  switchLang('id');
</script>
</body>
</html>
